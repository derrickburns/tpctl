---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: gloo
  namespace: gloo-system
  annotations:
    fluxcd.io/automated: "false"
spec:
  rollback:
    # If set, will perform rollbacks for this release.
    enable: true
    # If set, will force resource update through delete/recreate if
    # needed.
    force: true
    # Prevent hooks from running during rollback.
    disableHooks: true
  releaseName: gloo
  chart:
    repository: https://storage.googleapis.com/solo-public-helm/
    name: gloo
    version: "0.18.40"
  values:
    crds:
      create: false
    settings:
      create: false
    discovery:
      fdsMode: "WHITELIST"
    gatewayProxies:
      gatewayProxyV2:
        readConfig: true
        service:
          extraAnnotations:
            service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
            external-dns.alpha.kubernetes.io/alias: "true"
            external-dns.alpha.kubernetes.io/hostname: ""
            service.beta.kubernetes.io/aws-load-balancer-additional-resource-tags: "cluster:{{ .ClusterName }}"
